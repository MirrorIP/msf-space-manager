var SpacesSDK=(function(){var f=(function(){var G=function(M){function N(Q){var P=String(Q);if(P.length===1){P="0"+P;}return P;}var L=M.getFullYear()+"-"+N(M.getMonth()+1)+"-"+N(M.getDate());L+="T"+N(M.getHours())+":"+N(M.getMinutes())+":"+N(M.getSeconds())+"."+String((M.getMilliseconds()/1000).toFixed(3)).slice(2,5);var O=-M.getTimezoneOffset();L+=(O>=0?"+":"-")+N(Math.floor(O/60))+":"+N(O%60);return L;};var J=function(O){var Q=/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):(\d\d))?$/;var P=Q.exec(O)||[];if(P[1]){var L=P[1].split(/\D/);for(var N=0;N<L.length;N++){L[N]=parseInt(L[N],10)||0;}L[1]-=1;if(P[5]){var R=(parseInt(P[5],10)*60);if(P[6]){R+=parseInt(P[6],10);}if(P[4]=="+"){R*=-1;}if(R){L[4]+=R;}}var M=new Date(Date.UTC(L[0],L[1],L[2],L[3],L[4],L[5]));if(L[6]){M.setMilliseconds(L[6]);}return M;}else{return NaN;}};var K=function(L){return L.replace(/^\s+|\s+$/g,"");};var C=function(M){var L;if(window.DOMParser){var N=new DOMParser();L=N.parseFromString(M,"text/xml");}else{L=new ActiveXObject("MSXML.DOMDocument");L.async=false;L.loadXML(M);}return L;};var I=function(M,N){if(!M){throw {name:"IllegalArgumentException",message:"A element name is required."};}var O=null;if(typeof(ActiveXObject)!="undefined"){O=new ActiveXObject("MSXML.DOMDocument");var L=(N)?O.createNode(1,M,N):O.createElement(M);O.appendChild(L);}else{if(document.implementation.createDocument){O=document.implementation.createDocument(N,M,null);}else{throw {name:"NotSupportedException",message:"The browser does not support the required XML operations."};}}return O;};var F=function(L){if(!L||(typeof L)!="object"){throw {name:"IllegalArgumentException",message:"A element name is required."};}var M=D.generateXMLString(L);return D.generateXMLDocumentFromString(M);};var E=function(L){return Strophe.serialize(L);};var H=function(O,P){var N;var L=null;var Q={};for(N=0;N<O.attributes.length;N++){Q[O.attributes.item(N).name]=O.attributes.item(N).value;}if(O.namespaceURI){Q.xmlns=O.namespaceURI;}L=$build(O.nodeName,Q);for(N=0;N<O.childNodes.length;N++){var M=O.childNodes[N];if(M.nodeType==3){L.t(M.nodeValue);}else{if(M.nodeType==4){L.cnode(M);L.up();}else{D.elementToStopheTree(M,L);}}}if(P){P.cnode(L.tree());P.up();}return L;};var D={getDateForISO8601:J,getISO8601ForDate:G,trimString:K,generateXMLDocumentFromString:C,createXMLDocument:I,createXMLDocumentWithElement:F,generateXMLString:E,elementToStopheTree:H,};return D;})();var n={OFFLINE:"OFFLINE",ONLINE:"ONLINE",ERROR:"ERROR",PENDING:"PENDING"};var i={MEMBER:"MEMBER",MODERATOR:"MODERATOR"};var o={PRIVATE:"PRIVATE",TEAM:"TEAM",ORGA:"ORGA",getTypeForString:function(D){for(var C in SpacesSDK.Type){if(typeof SpacesSDK.Type[C]==="string"){if(SpacesSDK.Type[C].toLowerCase()===D.toLowerCase()){return C;}}}return null;}};var s={ON:"ON",OFF:"OFF",DURATION:"DURATION"};var j=function(C){return{name:"SpaceManagementException",message:C};};var r=function(C){return{name:"UnknownEntityException",message:C};};var q=(function(){var D={CDM_0_1:"0.1",CDM_0_2:"0.2",CDM_1_0:"1.0",CDM_2_0:"2.0",getVersionForString:function(H){for(var G in SpacesSDK.cdm.CDMVersion){if(typeof SpacesSDK.cdm.CDMVersion[G]==="string"){if(SpacesSDK.cdm.CDMVersion[G]===H){return G;}}}return null;}};var C=function(L,I){var J=function(){return L;};var K=function(){return I?I:SpacesSDK.cdm.Reference.ReferenceType.DEPENDENCY;};var G=function(M){var N=M.ownerDocument;var O=N.createElement("reference");O.setAttribute("id",L);if(SpacesSDK.cdm.Reference.ReferenceType.WEAK==I){O.setAttribute("type",SpacesSDK.cdm.Reference.ReferenceType.WEAK);}M.appendChild(O);};var H={getId:J,getReferenceType:K,addToElement:G};return H;};C.ReferenceType={DEPENDENCY:"dependency",WEAK:"weak",getReferenceTypeForString:function(H){for(var G in SpacesSDK.cdm.Reference.ReferenceType){if(typeof SpacesSDK.cdm.Reference.ReferenceType[G]==="string"){if(SpacesSDK.cdm.Reference.ReferenceType[G]===H){return G;}}}return null;}};var F=function(I,M,K){var L=function(){return K;};var N=function(){return M;};var H=function(){return I;};var G=function(P){var T=P.ownerDocument;var S=T.createElement("creationInfo");if(I){var R=T.createElement("date");R.textContent=I;S.appendChild(R);}if(M){var Q=T.createElement("person");Q.textContent=M;S.appendChild(Q);}if(K){var O=T.createElement("application");O.textContent=K;S.appendChild(O);}P.appendChild(S);};var J={getApplication:L,getCreator:N,getCreationDate:H,addToElement:G};return J;};var E={CDMVersion:D,Reference:C,CreationInfo:F};return E;})();var a=function(D){var L=D.ownerDocument;var F={};var J={};(function(){if(!D){throw {name:"IllegalArgumentException",message:"XML document containing the CDM data is required."};}J.cdmVersion=D.getAttribute("cdmVersion")?D.getAttribute("cdmVersion"):SpacesSDK.cdm.CDMVersion.CDM_2_0;J.id=D.getAttribute("id");J.timestamp=D.getAttribute("timestamp");switch(J.cdmVersion){case SpacesSDK.cdm.CDMVersion.CDM_0_1:E(D);break;case SpacesSDK.cdm.CDMVersion.CDM_0_2:C(D);break;case SpacesSDK.cdm.CDMVersion.CDM_1_0:I(D);break;case SpacesSDK.cdm.CDMVersion.CDM_2_0:K(D);break;}})();function H(O){O.setAttribute("cdmVersion",J.cdmVersion);if(J.id){O.setAttribute("id",J.id);}if(J.timestamp){O.setAttribute("timestamp",J.timestamp);}}function E(P){J.creator=P.getAttribute("creator");var Q=function(){return J.creator;};var O=function(R){H(R);if(J.creator){R.setAttribute("creator",J.creator);}};F.getCreator=Q;F.applyToElement=O;}function C(P){J.creator=P.getAttribute("creator");J.ref=P.getAttribute("ref");var R=function(){return J.creator;};var Q=function(){return J.ref;};var O=function(S){H(S);if(J.creator){S.setAttribute("creator",J.creator);}if(J.ref){S.setAttribute("ref",J.ref);}};F.getCreator=R;F.getRef=Q;F.applyToElement=O;}function I(P){J.customId=P.getAttribute("customId");J.modelVersion=P.getAttribute("modelVersion");J.publisher=P.getAttribute("publisher");J.ref=P.getAttribute("ref");var S=function(){return J.customId;};var T=function(){return J.modelVersion;};var Q=function(){return J.publisher;};var R=function(){return J.ref;};var O=function(U){H(U);if(J.customId){U.setAttribute("customId",J.customId);}if(J.modelVersion){U.setAttribute("modelVersion",J.modelVersion);}if(J.ref){U.setAttribute("ref",J.ref);}if(J.publisher){U.setAttribute("publisher",J.publisher);}};F.getCustomId=S;F.getModelVersion=T;F.getPublisher=Q;F.getRef=R;F.applyToElement=O;}function K(V){J.customId=V.getAttribute("customId");J.modelVersion=V.getAttribute("modelVersion");J.publisher=V.getAttribute("publisher");J.ref=V.getAttribute("ref");J.copyOf=V.getAttribute("copyOf");J.updates=V.getAttribute("updates");for(var ah=0;ah<V.childNodes.length;ah++){var T=V.childNodes[ah];if(T.nodeType==1){switch(T.nodeName){case"summary":J.summary=T.textContent;break;case"references":J.references=[];for(var af=0;af<T.childNodes.length;af++){var ad=T.childNodes[af];if(ad.nodeName=="reference"){var U=ad.getAttribute("id");var R=SpacesSDK.cdm.Reference.ReferenceType.getReferenceTypeForString(ad.getAttribute("type"));J.references.push(new SpacesSDK.cdm.Reference(U,R));}}break;case"creationInfo":var S=null;var Y=null;var X=null;for(var af=0;af<T.childNodes.length;af++){var Z=T.childNodes[af];switch(Z.nodeName){case"date":S=Z.textContent;break;case"person":Y=Z.textContent;break;case"application":X=Z.textContent;break;}}J.creationInfo=SpacesSDK.cdm.CreationInfo(S,Y,X);break;}}}var Q=function(){return J.customId;};var ac=function(){return J.modelVersion;};var ak=function(){return J.publisher;};var ag=function(){return J.ref;};var ai=function(){return J.copyOf;};var ae=function(){return J.copyOf?true:false;};var ab=function(){return J.summary;};var P=function(){return J.updates;};var aj=function(){return J.updates?true:false;};var W=function(){return J.references;};var O=function(){return J.creationInfo;};var aa=function(al){H(al);var ao=["customId","modelVersion","ref","publisher","copyOf","updates"];for(var am=0;am<ao.length;am++){if(J[ao[am]]){al.setAttribute(ao[am],J[ao[am]]);}}var ap=al.ownerDocument;if(J.summary){var an=ap.createElement("summary");an.textContent=J.summary;al.appendChild(an);}if(J.references){var aq=ap.createElement("references");for(var am=0;am<J.references.length;am++){J.references[am].addToElement(aq);}al.appendChild(aq);}if(J.creationInfo){J.creationInfo.addToElement(al);}};F.getCustomId=Q;F.getModelVersion=ac;F.getPublisher=ak;F.getRef=ag;F.getCopyOf=ai;F.getSummary=ab;F.getReferences=W;F.getCreationInfo=O;F.applyToElement=aa;}var M=function(){return J.cdmVersion;};var G=function(){return J.id;};var N=function(){return(J.timestamp)?f.getDateForISO8601(J.timestamp):null;};F.getCDMVersion=M;F.getId=G;F.getTimeStamp=N;return F;};var x=function(M){var K={};(function(){K.cdmVersion=M?M:SpacesSDK.cdm.CDMVersion.CDM_2_0;})();var P=function(){var X=f.createXMLDocument("root");var S=X.childNodes[0];var V=["cdmVersion","customId","creator","customId","id","timestamp","modelVersion","publisher","ref","copyOf","updates"];for(var T=0;T<V.length;T++){if(K[V[T]]){S.setAttribute(V[T],K[V[T]]);}}if(K.summary){var U=X.createElement("summary");U.textContent=K.summary;S.appendChild(U);}if(K.references){var W=X.createElement("references");for(var T=0;T<K.references.length;T++){K.references[T].addToElement(W);}S.appendChild(W);}if(K.creationInfo){K.creationInfo.addToElement(S);}return new a(S);};var Q=function(S){K.creator=S;return C;};var H=function(S){K.customId=S;return C;};var D=function(S){K.id=S;return C;};var R=function(S){K.modelVersion=S;return C;};var I=function(S){K.publisher=S;return C;};var J=function(S){K.ref=S;return C;};var L=function(S){K.timestamp=S;return C;};var N=function(S){K.copyOf=S;return C;};var O=function(S){K.updates=S;return C;};var G=function(S){K.summary=S;return C;};var F=function(S){if(K.references==null){K.references=[];}K.references.push(S);return C;};var E=function(S){K.creationInfo=S;return C;};var C={build:P,setCreator:Q,setCustomId:H,setId:D,setModelVersion:R,setPublisher:I,setRef:J,setTimestamp:L,setCopyOf:N,setUpdates:O,setSummary:G,addReference:F,setCreationInfo:E};return C;};var w=function(I,P,G,K,J,M,L){var F=function(){return J;};var O=function(){return I;};var N=function(){return P;};var E=function(){return G;};var M=function(){return M;};var H=function(){return L;};var D=function(){return K?K:2000;};var C={getApplicationID:F,getDomain:O,getHost:N,getPort:E,isSecureConnection:M,isSelfSignedCertificateEnabled:H,requestTimeout:D};return C;};var b=function(T,D){var I=null;var G=null;var L=null;var H=null;var K=null;var E=null;var S=null;(function(){I=5222;G=true;L=true;H=T;K=D;S=2000;})();var N=function(){if(K==null||f.trimString(K).length==0){throw {name:"IllegalStateException",message:"The application identifier is not initialized or empty, but has to be set."};}var U=(H!=null)&&(f.trimString(H).length!=0);var V=(E!=null)&&(f.trimString(E).length!=0);if(!U&&!V){throw {name:"IllegalStateException",message:"Either hostname or domain has to be set."};}if(!U&&V){H=E;}else{if(!V&&U){E=H;}}return new w(H,E,I,S,K,G,L);};var M=function(U){K=U;return J;};var P=function(U){H=U;return J;};var Q=function(U){E=U;return J;};var O=function(U){I=U;return J;};var F=function(U){G=U;return J;};var R=function(U){L=U;return J;};var C=function(U){S=U;return J;};var J={build:N,setApplicationId:M,setDomain:P,setHost:Q,setPort:O,setSecureConnection:F,setSelfSignedCertificateEnabled:R,setTimeout:C};return J;};var y=function(F,H,G){var E=function(){return F;};var D=function(){return H;};var I=function(){return G;};var C={getSpacesServiceJID:E,getSpacesServiceVersion:D,getPersistenceServiceJID:I};return C;};var g=function(X,D,P,W){var Q=null;var R=null;var J=null;var M=null;var E=null;(function(){J=new k(X.toLowerCase(),P.getDomain(),P.getApplicationID());M=new Strophe.Connection(W);Q={};Strophe.log=function(Z,Y){if(Z===2){console.log("WARN: ",Y);}else{if(Z>=3){console.log("ERROR: ",Y);}}};N(SpacesSDK.ConnectionStatus.OFFLINE);})();function N(Y){R=Y;for(var Z in Q){var aa=Q[Z];aa.connectionStatusChanged(R);}}var C=function(af){var ab=null;var ad=null;var ac=null;var aa={xmlns:Strophe.NS.DISCO_ITEMS};var ae=$iq({from:J.getFullJID(),to:P.getDomain(),type:"get"}).c("query",aa);var Z=function(al){if(!af){return;}var ai=$(al);var ag=ai.find("item");for(var ak=0;ak<ag.length;ak++){var aj=ag[ak];if("MIRROR Spaces Service".toLowerCase()==aj.getAttribute("name").toLowerCase()){ab=aj.getAttribute("jid");}else{if("MIRROR Persistence Service".toLowerCase()==aj.getAttribute("name").toLowerCase()){ad=aj.getAttribute("jid");}}}if(ab){var ah=$iq({from:J.getFullJID(),to:ab,type:"get"}).c("spaces",{xmlns:Strophe.NS.SPACES}).c("version");M.sendIQ(ah,function(am){ac=am.getElementsByTagName("version")[0].textContent;af(new y(ab,ac,ad));},function(an){if(an){var am=an.getElementsByTagName("error")[0];console.warn("Failed to retrieve spaces service version: "+f.generateXMLString(am));}else{console.warn("Failed to retrieve spaces service version.");}af(new y(ab,null,ad));},P.requestTimeout());}else{af(new y(null,null,ad));}};var Y=function(ah){if(ah){var ag=$(ah).find("error");console.warn("Failed to retrieve network information: "+ag[0].getAttribute("code"),ag[0]);}else{console.log("Failed to retrieve network information.");}af();};M.sendIQ(ae,Z,Y,P.requestTimeout());};var T=function(Y){Q[Y.name]=Y;};var F=function(){N(SpacesSDK.ConnectionStatus.PENDING);M.connect(J.getFullJID(),D,function Y(aa,Z){if(aa==Strophe.Status.CONNECTED){M.send($pres());C(function(ab){E=ab;N(SpacesSDK.ConnectionStatus.ONLINE);});}else{if(aa==Strophe.Status.ERROR||aa==Strophe.Status.CONNFAIL||aa==Strophe.Status.AUTHFAIL){N(SpacesSDK.ConnectionStatus.ERROR);}else{if(aa==Strophe.Status.AUTHENTICATING||aa==Strophe.Status.DISCONNECTING||aa==Strophe.Status.CONNECTING){N(SpacesSDK.ConnectionStatus.PENDING);}else{if(aa==Strophe.Status.DISCONNECTED){N(SpacesSDK.ConnectionStatus.OFFLINE);}}}}});};var G=function(){M.register.connect(P.getHost(),function Y(Z){if(Z==Strophe.Status.REGISTER){M.register.fields.username=J.getUsername().toLowerCase();M.register.fields.password=D;M.register.submit();}else{if(Z==Strophe.Status.REGISTERED){M.authenticate();}else{if(Z==Strophe.Status.CONNECTED){M.send($pres());C(function(aa){E=aa;N(SpacesSDK.ConnectionStatus.ONLINE);});}else{if(Z==Strophe.Status.ERROR||Z==Strophe.Status.CONNFAIL||Z==Strophe.Status.AUTHFAIL||Z==Strophe.Status.SBMTFAIL||Z==Strophe.Status.REGIFAIL){N(SpacesSDK.ConnectionStatus.ERROR);}else{if(Z==Strophe.Status.AUTHENTICATING||Z==Strophe.Status.DISCONNECTING||Z==Strophe.Status.CONNECTING||Z==Strophe.Status.REGISTERING||Z==Strophe.Status.SUBMITTING){N(SpacesSDK.ConnectionStatus.PENDING);}else{if(Z==Strophe.Status.DISCONNECTED){N(SpacesSDK.ConnectionStatus.OFFLINE);}}}}}}});};var V=function(){if(R==SpacesSDK.ConnectionStatus.OFFLINE){return;}N(SpacesSDK.ConnectionStatus.PENDING);M.disconnect();N(SpacesSDK.ConnectionStatus.OFFLINE);};var K=function(){return P;};var H=function(){return J;};var I=function(){return E;};var O=function(){return R;};var U=function(){return M;};var S=function(Z){var Y=[];for(var aa in Q){if(Z.name===aa){continue;}Y[aa]=Q[aa];}Q=Y;};var L={addConnectionStatusListener:T,connect:F,connectAndCreateUser:G,disconnect:V,getConfiguration:K,getCurrentUser:H,getNetworkInformation:I,getStatus:O,getXMPPConnection:U,removeConnectionStatusListener:S};return L;};var v=function(E,D){var C=new Object();C.name=E;C.connectionStatusChanged=D;return C;};var B=function(H,W){var X=null;var R=null;var D=null;var U=null;var K=null;var M=null;var P=null;(function(){X=new Object();R=new Object();U=H.getXMPPConnection();K=H.getCurrentUser();M=new Object();P=H.getConfiguration().requestTimeout();U.addHandler(I,null,"message",null,null,null);})();function ab(aj){for(var ak in R){var ai=R[ak];var ah=ai.getPubSubChannel().getProperties();if(ah.node===aj){return ak;}}return null;}function Y(aq){var an=[];var ar=[];var ah=aq.getElementsByTagName("items")[0];if(ah&&ah!=null){var ai=ah.attributes.getNamedItem("node");if(ai&&ai.value){ah=ai.value;}else{if(ai&&ai.nodeValue){ah=ai.nodeValue;}else{return null;}}var ao=ab(ah);if(ao==null||!R[ao]){return;}var am=aq.getElementsByTagName("item");for(var ak=0;ak<am.length;ak++){if(am[ak].firstChild==null){if(am[ak].attributes.getNamedItem("id").value){an[an.length]=am[ak].attributes.getNamedItem("id").value;}else{an[an.length]=am[ak].attributes.getNamedItem("id").nodeValue;}}else{var ap=am[ak].firstChild;var al=f.createXMLDocumentWithElement(ap);var aj=new u(al.childNodes[0]);if(!D||D.isDataObjectValid(aj)){M[ao][M[ao].length]=aj;}ar[ar.length]=aj;}}if(an.length>0){G(ah,an);}return ar;}}function I(al){var an=al.getElementsByTagName("items")[0];if(an&&an!=null){var ak=an.attributes.getNamedItem("node");if(ak&&ak.value){an=ak.value;}else{if(ak&&ak.nodeValue){an=ak.nodeValue;}else{return true;}}if(!an||an==null){return true;}var ao=ab(an);if(!ao||ao==null){return true;}var ah=Y(al);if(!ah||ah==null){return true;}for(var aj in X){var am=X[aj];for(var ai=0;ai<ah.length;ai++){if(!D||D.isDataObjectValid(ah[ai])){am.handleDataObject(ah[ai],ao);}}}}return true;}function G(al,ah){for(var ai=0;ai<ah.length;ai++){var aj=ah[ai];var ak=$iq({from:this.jid,to:this.service,type:"get"}).c("pubsub",{xmlns:Strophe.NS.PUBSUB}).c("items",{node:al}).c("item",{id:aj});U.sendIQ(ak.tree(),function(){},function(){},P);}}var Q=function(ah){X[ah.name]=ah;};var O=function(){var ah=new Object();for(var ai in R){ah[ai]=R[ai];}return ah;};var ad=function(ah,ak,aj,ai){if(!aj){aj=function(){};}if(!ai){ai=function(al){console.warn("Failed to publish data object:",al);};}W.getSpace(ak,function(ao){if(ao==null){ai("A space with the given ID could not be retrieved.");return;}var ap=ao.getPubSubChannel().getProperties().node;var am=ah.getElement();var an=f.elementToStopheTree(am);var al=new Array();al[0]=new Object();al[0].attrs={};al[0].data=an.tree();U.pubsub.publish(ap,al,function(aq){switch(aq.getAttribute("type")){case"result":aj();break;default:ai(aq);break;}});},function(al){ai(al);});};var Z=function(ai,ah){if(R[ai]){return;}if(!ah){ah=function(aj){console.warn("An error occured while the space was registered.",aj);};}W.getSpace(ai,function(aj){R[aj.getId()]=aj;M[aj.getId()]=[];},function(aj){ah(aj);});};var aa=function(ai){var ah=new Object();for(var aj in X){if(ai.name===aj){continue;}ah[aj]=X[aj];}X=ah;};var ae=function(aj){if(!R[aj]){return;}else{var ai=[];for(var ah in R){if(ah===aj){continue;}ai[ah]=R[ah];}R=ai;delete M[aj];}};var C=function(ah){return M[ah]?M[ah]:[];};var J=function(ah){D=ah;};var E=function(){return D;};function L(aj,ak,ai){var ah=[];U.sendIQ(aj,function(ap){var am=ap.getElementsByTagName("result")[0];for(var al=0;al<am.children.length;al++){var ao=am.children[al];var an=new u(ao);ah.push(an);}ak(ah);},function(am){if(am){var al=am.getElementsByTagName("error")[0];ai("Peristence service query failed: "+f.generateXMLString(al));}else{ai("Persistence service query failed.");}},H.getConfiguration().requestTimeout());}var T=function(ah,al,ak){if(!ak){ak=function(am){console.warn("[ERROR] "+am);};}if(H.getStatus()!=n.ONLINE){ak("You must be online in order to query data.");return;}var aj=H.getNetworkInformation().getPersistenceServiceJID();if(!aj){ak("No persistence service available.");}var ai=$iq({from:H.getCurrentUser().getFullJID(),to:aj,type:"get"}).c("query",{xmlns:"urn:xmpp:spaces:persistence"});ai.c("object",{id:ah});L(ai,function(am){al(am.length>0?am[0]:null);},ak);};var F=function(ak,aj,an,am){if(!am){am=function(ar){console.warn("[ERROR] "+ar);};}var aq=[];if(0==ak.length){an(aq);return;}if(H.getStatus()!=n.ONLINE){am("You must be online in order to query data.");return;}var ah=H.getNetworkInformation().getPersistenceServiceJID();if(!ah){am("No persistence service available.");}var ao=$iq({from:H.getCurrentUser().getFullJID(),to:ah,type:"get"}).c("query",{xmlns:"urn:xmpp:spaces:persistence"});ao.c("objects");for(var al=0;al<ak.length;al++){ao.c("object",{id:ak[al]}).up();}if(aj&&aj.length>0){ao.up().c("filters");for(var al=0;al<aj.length;al++){var ai=aj[al];if(ai.getFilterAsXML){var ap=ai.getFilterAsXML("urn:xmpp:spaces:persistence");f.elementToStopheTree(ap,ao);}}}L(ao,an,am);};function N(al,aj,ak,ai){var ah=[];W.getSpace(al,function(am){if(am.getPersistenceType()==s.ON){U.pubsub.items(am.getPubSubChannel().getProperties().node,function(ay){var av=[];var az=[];var an=ay.getElementsByTagName("items")[0];if(an){var ao=an.attributes.getNamedItem("node");if(ao&&ao.value){an=ao.value;}else{if(ao&&ao.nodeValue){an=ao.nodeValue;}else{ai("Failed to retrieve items from pubsub node.");}}var au=ay.getElementsByTagName("item");for(var ar=0;ar<au.length;ar++){if(au[ar].firstChild==null){if(au[ar].attributes.getNamedItem("id").value){av[av.length]=au[ar].attributes.getNamedItem("id").value;}else{av[av.length]=au[ar].attributes.getNamedItem("id").nodeValue;}}else{var ax=au[ar].firstChild;var at=f.createXMLDocumentWithElement(ax);var ap=new u(at.firstChild);var aw=true;for(var aq=0;aq<aj.length;aq++){aw&=aj[aq].isDataObjectValid(ap);}if(aw){ah.push(ap);}}}ak(ah);}else{ak(ah);}},function(an){ai("Failed to retrieve data objects from pubsub node.",an);},P);}else{ak(ah);}},function(am){ai("Failed to retrieve space information. ",am);});}var ag=function(ao,aj,am,al){if(!al){al=function(ar){console.warn("[ERROR] "+ar);};}var aq=[];if(H.getStatus()!=n.ONLINE){al("You must be online in order to query data.");return;}var ah=H.getNetworkInformation().getPersistenceServiceJID();if(!ah){N(ao,aj,am,al);return;}var an=$iq({from:H.getCurrentUser().getFullJID(),to:ah,type:"get"}).c("query",{xmlns:"urn:xmpp:spaces:persistence"});an.c("objectsForSpace",{id:ao});if(aj&&aj.length>0){an.up().c("filters");for(var ak=0;ak<aj.length;ak++){var ai=aj[ak];if(ai.getFilterAsXML){var ap=ai.getFilterAsXML("urn:xmpp:spaces:persistence");f.elementToStopheTree(ap,an);}}}L(an,am,al);};var ac=function(ao,aj,am,al){if(!al){al=function(ar){console.warn("[ERROR] "+ar);};}var aq=[];if(ao.length==0){am(aq);return;}if(H.getStatus()!=n.ONLINE){al("You must be online in order to query data.");return;}var ah=H.getNetworkInformation().getPersistenceServiceJID();if(!ah){al("No persistence service available.");return;}var an=$iq({from:H.getCurrentUser().getFullJID(),to:ah,type:"get"}).c("query",{xmlns:"urn:xmpp:spaces:persistence"});an.c("objectsForSpaces");for(var ak=0;ak<ao.length;ak++){an.c("space",{id:ao[ak]}).up();}if(aj&&aj.length>0){an.up().c("filters");for(var ak=0;ak<aj.length;ak++){var ai=aj[ak];if(ai.getFilterAsXML){var ap=ai.getFilterAsXML("urn:xmpp:spaces:persistence");f.elementToStopheTree(ap,an);}}}L(an,am,al);};var V=function(ah,al,ak){if(!ak){ak=function(am){console.warn("[ERROR] "+am);};}if(H.getStatus()!=n.ONLINE){ak("You must be online in order to perform the query.");return;}var aj=H.getNetworkInformation().getPersistenceServiceJID();if(!aj){ak("No persistence service available.");return;}var ai=$iq({from:H.getCurrentUser().getFullJID(),to:aj,type:"set"}).c("delete",{xmlns:"urn:xmpp:spaces:persistence"});ai.c("object",{id:ah});U.sendIQ(ai,function(an){var am=an.getElementsByTagName("delete")[0];var ao=am.getAttribute("objectsDeleted");al(parseInt(ao)>0);},function(an){if(an){var am=an.getElementsByTagName("error")[0];ak("Peristence service query failed: "+f.generateXMLString(am));}else{ak("Persistence service query failed.");}},H.getConfiguration().requestTimeout());};var af=function(ai,am,al){if(!al){al=function(an){console.warn("[ERROR] "+an);};}if(ai.length==0){am(0);return;}if(H.getStatus()!=n.ONLINE){al("You must be online in order to perform the query.");return;}var ak=H.getNetworkInformation().getPersistenceServiceJID();if(!ak){al("No persistence service available.");return;}var aj=$iq({from:H.getCurrentUser().getFullJID(),to:ak,type:"set"}).c("delete",{xmlns:"urn:xmpp:spaces:persistence"});aj.c("objects");for(var ah=0;ah<ai.length;ah++){aj.c("object",{id:ai[ah]}).up();}U.sendIQ(aj,function(ao){var an=ao.getElementsByTagName("delete")[0];var ap=an.getAttribute("objectsDeleted");am(parseInt(ap));},function(ao){if(ao){var an=ao.getElementsByTagName("error")[0];al("Peristence service query failed: "+f.generateXMLString(an));}else{al("Persistence service query failed.");}},H.getConfiguration().requestTimeout());};var S={addDataObjectListener:Q,getHandledSpaces:O,publishDataObject:ad,registerSpace:Z,removeDataObjectListener:aa,removeSpace:ae,retrieveDataObjects:C,setDataObjectFilter:J,getDataObjectFilter:E,queryDataObjectById:T,queryDataObjectsById:F,queryDataObjectsBySpace:ag,queryDataObjectsBySpaces:ac,deleteDataObject:V,deleteDataObjects:af};return S;};var A=function(G,F){var E=function(){return G;};var C=function(){return F;};var H=function(I){if(I==null){return false;}if(I.getNamespace==null||typeof I.getNamespace!=="function"){return false;}else{if(I.getSchemaLocation==null||typeof I.getSchemaLocation!=="function"){return false;}else{if(I.getSchemaLocation()===F&&I.getNamespace()===G){return true;}}}return false;};var D={getNamespace:E,getSchemaLocation:C,equals:H};return D;};var p=(function(){var E=function(){var M=[];var L=function(O){if(!O.isDataObjectValid){throw"Invalid data object filter.";return;}M.push(O);};var N=function(){return M;};var J=function(P){for(var O=0;O<M.length;O++){if(!M[O].isDataObjectValid(P)){return false;}}return true;};var K={addFilter:L,getFilters:N,isDataObjectValid:J};return K;};var G=function(P,L){var O=function(){return P;};var N=function(){return L;};var K=function(Q){if(P==Q.getNamespaceURI()){if(L){if(L==Q.getModelVersion()){return true;}else{return false;}}return true;}else{return false;}};var J=function(R){var Q=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(R,"dataModel");Q.setAttribute("namespace",P);if(L){Q.setAttribute("version",L);}return Q;};var M={getNamespace:O,getVersion:N,isDataObjectValid:K,getFilterAsXML:J};return M;};var H=function(O,N){(function(){if(!N){N=H.CompareType.STRICT;}})();var L=function(){return O;};var P=function(){return N;};var K=function(S){var R=S.getNamespaceURI()?S.getNamespaceURI():"";switch(N){case H.CompareType.STRICT:if(R!=O){return false;}break;case H.CompareType.CONTAINS:if(R.indexOf(O)<0){return false;}break;case H.CompareType.REGEX:var Q=R.match(O);if(!Q||Q[0]!=R){return false;}break;}return true;};var J=function(R){var Q=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(R,"namespace");Q.setAttribute("compareType",N);Q.textContent=O;return Q;};var M={getCompareString:L,getCompareType:P,isDataObjectValid:K,getFilterAsXML:J};return M;};H.CompareType={STRICT:"strict",CONTAINS:"contains",REGEX:"regex"};var I=function(){var M=[];var L=function(O){if(!O.isDataObjectValid){throw"Invalid data object filter.";return;}M.push(O);};var N=function(){return M;};var J=function(P){for(var O=0;O<M.length;O++){if(M[O].isDataObjectValid(P)){return true;}}return false;};var K={addFilter:L,getFilters:N,isDataObjectValid:J};return K;};var F=function(P,O){var M=function(){return P;};var N=function(){return O;};var K=function(Q){var T=Q.getElement().getAttribute("timestamp");if(T){try{var R=f.getDateForISO8601(T);if(P&&O){return(P<=R&&R<=O);}else{if(P){return(P<=R);}else{if(O){return(R<=O);}}}}catch(S){console.warn("Failed to parse data object timestamp. Object filter is NOT applied.");return true;}}else{return false;}};var J=function(R){var Q=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(R,"period");if(P){Q.setAttribute("from",SpacesSDK.Utils.getISO8601ForDate(P));}if(O){Q.setAttribute("to",SpacesSDK.Utils.getISO8601ForDate(O));}return Q;};var L={getFrom:M,getTo:N,isDataObjectValid:K,getFilterAsXML:J};return L;};var D=function(N){var M=function(){return N;};var K=function(O){var P=O.getElement().getAttribute("publisher");if(P){return(P.indexOf(N)==0);}else{return false;}};var J=function(P){var O=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(P,"publisher");O.textContent=N;return O;};var L={getPublisher:M,isDataObjectValid:K,getFilterAsXML:J};return L;};var C=function(M){var N=function(){return M;};var K=function(O){var P=O.getElement().getAttribute("ref");if(P){return(P==M);}else{return false;}};var J=function(O){var P=SpacesSDK.Utils.createXMLDocument("dummy").createElementNS(O,"references");P.setAttribute("id",M);return P;};var L={getReferenceId:N,isDataObjectValid:K,getFilterAsXML:J};return L;};return{AndFilter:E,DataModelFilter:G,NamespaceFilter:H,OrFilter:I,PeriodFilter:F,PublisherFilter:D,ReferencesFilter:C};})();var u=function(C){var L=C.ownerDocument;var M=null;(function(){if(!C){throw {name:"IllegalArgumentException",message:"The XML DOM must contain a root element."};}var Q=C.getAttribute("cdmVersion");if(Q&&SpacesSDK.cdm.CDMVersion.getVersionForString(Q)!=null){M=new a(C);}else{M=null;}})();var J=function(){return M;};var N=function(){return C.getAttribute("cdmVersion");};var I=function(){var Q=C.getAttribute("xsi:schemaLocation");if(Q!=null){return new A(Q.split(" ")[0],Q.split(" ")[1]);}return null;};var E=function(){return C;};var F=function(){return C.tagName;};var H=function(){return C.getAttribute("id");};var K=function(){return C.getAttribute("modelVersion");};var P=function(){return C.namespaceURI;};var O=function(){return C.namespaceURI.indexOf("mirror:application:")==0;};var G=function(){return f.generateXMLString(C);};var D={getCDMData:J,getCDMVersion:N,getDataModel:I,getElement:E,getElementName:F,getId:H,getModelVersion:K,getNamespaceURI:P,isMIRRORDataObject:O,toString:G};return D;};var t=function(O,I){var G=null;(function(){if(!O){throw {name:"IllegalArgumentException",message:"Missing element name."};}G=f.createXMLDocument(O,I);})();var K=function(S,T,ac){var P=G.childNodes[0];P.setAttribute("xmlns:cdt","mirror:common:datatypes");var ab=G.createElement("creationInfo");if(S){var Y=S.getFullYear();var V=(S.getMonth()+1)<10?"0"+(S.getMonth()+1):(S.getMonth()+1);var Z=S.getDate();var Q=S.getMilliseconds();Q=Q<10?"00"+Q:(Q<100?"0"+Q:Q);var R=S.toTimeString().match(/([0-9]{2}:[0-9]{2}:[0-9]{2}|[+-][0-9]{4})/g);R[1]=R[1].substr(0,3)+":"+R[1].substr(3,2);var X=G.createElement("cdt:date");var W=G.createTextNode(Y+"-"+V+"-"+Z+"T"+R[0]+"."+Q+R[1]);X.appendChild(W);ab.appendChild(X);}if(T){var U=G.createElement("cdt:person");U.appendChild(G.createTextNode(T));ab.appendChild(U);}if(ac){var aa=G.createElement("cdt:application");aa.appendChild(G.createTextNode(ac));ab.appendChild(aa);}P.appendChild(ab);return C;};var J=function(S,T){var P=G.childNodes[0];var R=G.createElement("attachment");if(T){R.setAttribute("type",T);}var Q=G.createElementNS("mirror:common:datatypes","cdt:link");Q.setAttribute("url",S);R.appendChild(Q);P.appendChild(R);};var F=function(Q,U,S){var P=G.childNodes[0];var R=G.createElement("attachment");if(S){R.setAttribute("type",S);}var T=G.createElementNS("mirror:common:datatypes","cdt:body");if(U){T.setAttribute("mimeType",U);}T.appendChild(G.createTextNode(Q));R.appendChild(T);P.appendChild(R);};var H=function(Q,R,V,S){if(!Q){throw {name:"IllegalArgumentException",message:"The tag name is required."};}var P=G.childNodes[0];var T=G.createElement(Q);if(R){for(var X in R){T.setAttribute(X,R[X]);}}if(V){if(S){var W=f.generateXMLDocumentFromString(V);T.appendChild(W.childNodes[0]);}else{var U=G.createTextNode(V);T.appendChild(U);}}P.appendChild(T);return C;};var D=function(Q,R){if(!Q||!R){throw {name:"IllegalArgumentException",message:"Attribute name and value are required."};}var P=G.childNodes[0];P.setAttribute(Q,R);return C;};var L=function(){return new u(G.childNodes[0]);};var E=function(P){P.applyToElement(G.childNodes[0]);return C;};var N=function(Q){var P=G.childNodes[0];P.setAttribute("modelVersion",Q);return C;};var M=function(){return G.childNodes[0];};var C={addCDTAttachmentWithLink:J,addCDTAttachmentWithBody:F,addCDTCreationInfo:K,addNewElement:H,setAttribute:D,build:L,setCDMData:E,setModelVersion:N,getRootElement:M};return C;};var m=function(C,E){var D=new Object();D.name=C;D.handleDataObject=E;return D;};var d=function(ac,R,ab,D,F,C,X,M,G){var P={};(function(){if(F==o.ORGA&&D==null){D=[];}if(C==null){C=[];}if(X==null){X=[];}switch(F){case SpacesSDK.Type.PRIVATE:K();break;case SpacesSDK.Type.ORGA:J();case SpacesSDK.Type.TEAM:H();break;}})();function K(){var ad=function(){return X[0].getJID();};P.getOwner=ad;}function J(){var ad=function(){var ae=[];for(var af=0;af<D.length;af++){ae[af]=D[af];}return ae;};P.getSupportedDataModels=ad;}function H(){var ad=function(){for(var ae=0;ae<C.length;ae++){if(C[ae].getType()==="muc"){return C[ae];}}return null;};P.getMUCChannel=ad;}var O=function(ad){if(ad.getId==null||typeof ad.getId!=="function"){return false;}else{if(ad.getType==null||typeof ad.getType!=="function"){return false;}else{if(F===ad.getType()&&R.toLowerCase()===space.getId().toLowerCase()){return true;}}}return false;};var L=function(){var ad=new l();ad.setName(ac);ad.setType(F);ad.setPersistenceType(M);ad.setPersistenceDuration(G);for(var ae=0;ae<X.length;ae++){var af=new c(X[ae].getJID(),X[ae].getRole());ad.addMember(af);}return ad;};var aa=function(){var ad=[];for(var ae=0;ae<C.length;ae++){ad[ae]=C[ae];}return ad;};var Y=function(){return ab;};var Q=function(){return R;};var E=function(){var ad=[];for(var ae=0;ae<X.length;ae++){ad[ae]=X[ae];}return ad;};var T=function(){return ac;};var S=function(){for(var ad=0;ad<C.length;ad++){if(C[ad].getType()==="pubsub"){return C[ad];}}return null;};var V=function(){return F;};var U=function(ae){for(var ad=0;ad<X.length;ad++){if(X[ad].getJID()===ae){return true;}}return false;};var N=function(ae){for(var ad=0;ad<X.length;ad++){if(X[ad].getJID()===ae){if(X[ad].getRole()===SpacesSDK.Role.MODERATOR){return true;}}}return false;};var W=function(){return M;};var I=function(){if(W()==SpacesSDK.PersistenceType.DURATION){return G;}else{return null;}};var Z=function(){for(var ad=0;ad<C.length;ad++){if(C[ad].getType()==="persistence"){return C[ad];}}return null;};P.equals=O;P.generateSpaceConfiguration=L;P.getChannels=aa;P.getDomain=Y;P.getId=Q;P.getMembers=E;P.getName=T;P.getPubSubChannel=S;P.getType=V;P.isMember=U;P.isModerator=N;P.getPersistenceType=W;P.getPersistenceDuration=I;P.getPersistenceChannel=Z;return P;};var e=function(E,D){var G=function(){return D;};var F=function(){return E;};var C={getProperties:G,getType:F};return C;};var l=function(E,T,R,J,G){(function(){if(R==null){R=[];}else{if(!R.length||R.length<0){var U=R;R=[];R.push(U);}}})();var O=function(U){S(U.getJID());R.push(U);};var C=function(){return R;};var M=function(){return T;};var P=function(){return E;};var Q=function(){return J;};var I=function(){if(Q()==SpacesSDK.PersistenceType.DURATION){return G;}else{return null;}};var S=function(U){for(var W=0;W<R.length;W++){if(R[W].getJID()===U){for(var V=W;V<R.length-1;V++){R[V]=R[V+1];}R.length=R.length-1;break;}}};var N=function(U){R=U;};var H=function(U){T=U;};var D=function(U){J=U;};var F=function(U){G=U;};var K=function(U){E=U;};var L={addMember:O,getMembers:C,getName:M,getType:P,getPersistenceType:Q,getPersistenceDuration:I,removeMember:S,setMembers:N,setName:H,setPersistenceType:D,setType:K,setPersistenceDuration:F};return L;};var h=function(D){var M=null;var F=null;var I=null;(function(){M=D.getXMPPConnection();F=D.getCurrentUser();I=D.getConfiguration().requestTimeout();})();var H=function(U,X,W,V){if(!W||!V){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}N.getSpace(X,function(aa){var Y=aa.getMembers();for(var Z=0;Z<Y.length;Z++){if(Y[Z].getJID().toLowerCase()===U.split("/")[0].toLowerCase()){if(Y[Z].getRole()===SpacesSDK.Role.MODERATOR){W(true);return;}}}W(false);},V);};var Q=function(U){if(!U.getName()||f.trimString(U.getName()).length==0){throw {name:"IllegalArgumentException",message:"Please specify a name which consists of at least one letter"};}else{if(!U.getType()||!o[U.getType()]){throw {name:"IllegalArgumentException",message:"Please specify a type which is in the enum Type."};}else{if(!U.getPersistenceType()||!s[U.getPersistenceType()]){throw {name:"IllegalArgumentException",message:"Invalid persistence type."};}else{for(var V=0;V<U.getMembers().length;V++){if(U.getMembers()[V].getRole()===i.MODERATOR){return;}}throw {name:"IllegalArgumentException",message:"Please specify at least one moderator"};}}}};var C=function(X,Z,W){if(!Z||!W){throw {name:"IllegalArgumentException",message:"You have to specify two Callbacks."};}if(X.getType().toLowerCase()!==SpacesSDK.Type.ORGA.toLowerCase()){throw {name:"IllegalArgumentException",message:"The given id doesn't belong to an Orgaspace."};}var Y="spaces."+M.domain;var U={xmlns:Strophe.NS.SPACES};var V=$iq({from:F.getFullJID(),to:Y,type:"get"}).c("spaces",U).c("models",{space:X.getId()});M.sendIQ(V,function(ae){var aa=ae;var ab=new Array();models=aa.getElementsByTagName("model");for(var ad=0;ad<models.length;ad++){var ac=models[ad].attributes;if(ac.getNamedItem("namespace").value){ab.push(new A(ac.getNamedItem("namespace").value,ac.getNamedItem("schemaLocation").value));}else{ab.push(new A(ac.getNamedItem("namespace").nodeValue,ac.getNamedItem("schemaLocation").nodeValue));}}Z(ab);},W,I);};var N=new Object();var L=function(X,U,W,V){if(!W||!V){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}Q(U);H(F.getBareJID(),X,function(ac){if(!ac){throw new SpacesSDK.SpaceManagementException("You have to be an moderator of an space to change its configuration.");}var ae="spaces."+M.domain;var aa={xmlns:Strophe.NS.SPACES};var ad=$iq({from:F.getFullJID(),to:ae,type:"set"}).c("spaces",aa).c("configure",{space:X}).c("x",{xmlns:Strophe.NS.DATA,type:"submit"});ad.c("field",{"var":"FORM_TYPE",type:"hidden"}).c("value",null,Strophe.NS.SPACES+":config").up();ad.c("field",{"var":"spaces#type"}).c("value",null,o[U.getType()].toLowerCase()).up();var Y;switch(U.getPersistenceType()){case SpacesSDK.PersistenceType.ON:Y="true";break;case SpacesSDK.PersistenceType.OFF:Y="false";break;default:Y=U.getPersistenceDuration();}ad.c("field",{"var":"spaces#persistent"}).c("value",null,Y).up();ad.c("field",{"var":"spaces#name"}).c("value",null,U.getName()).up();ad.c("field",{"var":"spaces#members"});var Z=U.getMembers();for(var ab=0;ab<Z.length;ab++){var af=Z[ab];ad.c("value",null,af.getJID());}ad.up().c("field",{"var":"spaces#moderators"});for(var ab=0;ab<Z.length;ab++){var af=Z[ab];if(af.getRole()===SpacesSDK.Role.MODERATOR){ad.c("value",null,af.getJID());}}M.sendIQ(ad,function(ag){N.getSpace(X,W,V);},V,I);},V);};var J=function(Y,W){if(!Y||!W){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}var X="spaces."+M.domain;var U={xmlns:Strophe.NS.SPACES};var V=$iq({from:F.getFullJID(),to:X,type:"set"}).c("spaces",U).c("create",null);M.sendIQ(V,function(Z){N.getDefaultSpace(Y,W);},W,I);};var E=function(U,ab,Z){if(!ab||!Z){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}Q(U);var aa="spaces."+M.domain;var ac={xmlns:Strophe.NS.SPACES};var ad=$iq({from:F.getFullJID(),to:aa,type:"set"}).c("spaces",ac).c("create",null).up().c("configure",null).c("x",{xmlns:Strophe.NS.DATA,type:"submit"});ad.c("field",{"var":"FORM_TYPE",type:"hidden"}).c("value",null,Strophe.NS.SPACES+":config").up();ad.c("field",{"var":"spaces#type"}).c("value",null,o[U.getType()].toLowerCase()).up();var V;switch(U.getPersistenceType()){case SpacesSDK.PersistenceType.ON:V="true";break;case SpacesSDK.PersistenceType.OFF:V="false";break;default:V=U.getPersistenceDuration();}ad.c("field",{"var":"spaces#persistent"}).c("value",null,V).up();ad.c("field",{"var":"spaces#name"}).c("value",null,U.getName()).up();ad.c("field",{"var":"spaces#members"});var W=U.getMembers();for(var Y=0;Y<W.length;Y++){var X=W[Y];ad.c("value",null,X.getJID());}ad.up().c("field",{"var":"spaces#moderators"});for(var Y=0;Y<W.length;Y++){var X=W[Y];if(X.getRole()===SpacesSDK.Role.MODERATOR){ad.c("value",null,X.getJID());}}M.sendIQ(ad,function(af){var ae=af;N.getSpace(ae.getElementsByTagName("create")[0].attributes.space.nodeValue,ab,Z);},Z,I);};var K=function(W,V,U){if(!V){V=function(){console.log("Successfully deleted space.");};}if(!U){U=function(X){console.warn("Failed to delete space:",X);};}H(F.getBareJID(),W,function(Z){if(!Z){U("You are not allowed to delete this space.");return;}var aa="spaces."+M.domain;var Y={xmlns:Strophe.NS.SPACES};var X=$iq({from:F.getFullJID(),to:aa,type:"set"}).c("spaces",Y).c("delete",{space:W});M.sendIQ(X,function(ab){V();},function(ab){U(ab);});},function(X){U(X);});};var O=function(V,W,U){if(!W||!U){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}M.spaces.getSpaceDetails(V.id,function(X){var Y=X;M.spaces.getSpaceChannels(V.id,function(am){var ag=am;var ad=[];var ab=[];var al=SpacesSDK.Type.getTypeForString(Y.type);var aa=[];for(var af=0;af<Y.members.length;af++){var ae=SpacesSDK.Role.MEMBER;for(var ac=0;ac<Y.moderators.length;ac++){if(Y.moderators[ac]===Y.members[af]){ae=SpacesSDK.Role.MODERATOR;}}ad.push(new c(Y.members[af],ae));}for(var aj in ag){var ai={};for(var ak in ag[aj]){ai[ak]=ag[aj][ak];}ab.push(new e(aj,ai));}var Z;var ah;switch(typeof Y.persistent){case"boolean":Z=Y.persistent?SpacesSDK.PersistenceType.ON:SpacesSDK.PersistenceType.OFF;ah=null;break;case"string":Z=SpacesSDK.PersistenceType.DURATION;ah=Y.persistent;break;}if(al===SpacesSDK.Type.ORGA){C(new d(V.name,V.id,V.domain,aa,al,ab,ad,Z,ah),function(an){W(new d(V.name,V.id,V.domain,an,al,ab,ad,Z,ah));},U);}else{W(new d(V.name,V.id,V.domain,aa,al,ab,ad,Z,ah));}},U,I);},U,I);};var R=function(V,U){if(!V||!U){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}M.spaces.getSpacesList(function(aa){var Y=aa;var W=[];var ac=new Object();var ad=function(af){if(!ac[af.getId()]){ac[af.getId()]=true;W.push(af);for(var ae=0;ae<Y.length;ae++){if(!ac[Y[ae].id]){return;}}V(W);}};for(var Z=0;Z<Y.length;Z++){var ab=Z;var X=function(af){if(!ac[Y[ab].Id]){ac[Y[ab].id]=true;for(var ae=0;ae<Y.length;ae++){if(!ac[Y[ae].id]){return;}}V(W);}};O(Y[Z],ad,X);}},U,I);};var T=function(V,U){N.getSpace(F.getUsername(),V,U);};var G=function(W,V,U){if(!V||!U){throw {name:"IllegalArgumentException",message:"You have to specify two Callbacks."};}M.spaces.getSpacesList(function(X){var Y=X;var aa=null;for(var Z=0;Z<Y.length;Z++){if(Y[Z].id!==W){continue;}aa=Y[Z];}if(aa!=null){O(aa,V,U);}else{V(null);}},U,I);};var P=function(W,V){if(!W||!V){throw {name:"IllegalArgumentException",message:"You have to specify two Callbacks."};}var U=function(X){var Y=X;var X={};if(Y!=null){for(var Z=0;Z<Y.length;Z++){X[Y[Z].id]=Y[Z].name;}}W(X);};M.spaces.getSpacesList(U,V,I);};var S=function(X,U,W,V){if(!W||!V){throw {name:"IllegalArgumentException.",message:"You have to specify two Callbacks."};}H(F.getBareJID(),X,function(Y){if(!Y){throw new SpacesSDK.SpaceManagementException("You have to be an moderator of an space to delete it.");}N.getSpace(X,function(ac){if(ac==null){throw new SpacesSDK.UnknownEntityException("A space with such an id couldn't be found.");}else{if(ac.getType().toLowerCase()!==SpacesSDK.Type.ORGA.toLowerCase()){throw {name:"IllegalArgumentException.",message:"The given id doesn't belong to an Orgaspace."};}}var ad="spaces."+M.domain;var Z={xmlns:Strophe.NS.SPACES};var ab=$iq({from:F.getFullJID(),to:ad,type:"set"}).c("spaces",Z).c("models",{space:X});for(var aa=0;aa<U.length;aa++){ab.c("model",{namespace:U[aa].getNamespace(),schemaLocation:U[aa].getSchemaLocation()}).up();}M.sendIQ(ab,function(ae){W(new d(ac.getName(),X,ac.getDomain(),U,ac.getType(),ac.getChannels(),ac.getMembers(),ac.getPersistenceType(),ac.getPersistenceDuration()));},V,I);},V);},V);};var N={configureSpace:L,createDefaultSpace:J,createSpace:E,deleteSpace:K,getAllSpaces:R,getDefaultSpace:T,getSpace:G,getSpacesList:P,setModelsSupportedBySpace:S};return N;};var c=function(F,H){(function(){if(!F.match(/@/)){throw {name:"IllegalArgumentException",message:"There has to be a domain as part of the jid."};}if(F.match(/\//)){F=F.split("/")[0];}})();var G=function(I){if(I.getJID==null||typeof I.getJID!=="function"){return false;}else{if(I.getRole==null||typeof I.getRole!=="function"){return false;}else{if(I.getJID()===F&&I.getRole===H){return true;}}}return false;};var E=function(){return F;};var D=function(){return H;};var C={equals:G,getJID:E,getRole:D};return C;};var k=function(H,G,E){var D=function(){var L=[];L.push(H,"@",G);return L.join("");};var K=function(){return G;};var F=function(){var L=[];L.push(H,"@",G,"/",E);return L.join("");};var I=function(){return E;};var J=function(){return H;};var C={getBareJID:D,getDomain:K,getFullJID:F,getResource:I,getUsername:J};return C;};var z={Utils:f,cdm:q,ConnectionStatus:n,Role:i,Type:o,PersistenceType:s,SpaceManagementException:j,UnknownEntityException:r,CDMData:a,CDMDataBuilder:x,ConnectionConfiguration:w,ConnectionConfigurationBuilder:b,ConnectionHandler:g,ConnectionStatusListener:v,NetworkInformation:y,DataHandler:B,DataModel:A,DataObject:u,DataObjectBuilder:t,DataObjectListener:m,Space:d,SpaceChannel:e,SpaceConfiguration:l,SpaceHandler:h,SpaceMember:c,UserInfo:k,filter:p};return z;})();